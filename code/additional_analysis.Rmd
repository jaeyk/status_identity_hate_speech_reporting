---
title: "Additional analysis"
author: "Jae Yeon Kim"
date: "1/4/2021"
output: html_document
---

# Import libs and files 

## Libs 

```{r}

if (!require(pacman)) install.packages("pacman")

pacman::p_load(tidyverse, 
               here,
               ggthemes, # Additional themes (including Stata)
               pwr, # Power analysis 
               DeclareDesign, 
               fabricatr, # Fabricate mock (fake) data  
               randomizr, # Random sampling and assignment 
               estimatr, # Fast estimation tools (IV, etc) 
               DesignLibrary) # Research design library 

```

## Files 

```{r}

# Processed data 
df <- read_csv(here("processed_data", "main_dataset_20201020.csv"))

```

# Design analysis 

## Group assignment 

The total number of observations = 1,250 

```{r}

nrow(df)

```

Four treatment conditions plus one control condition. 250 individuals were assigned to each group. 

```{r}

table(df$group)

```

## Power calculation analysis 

Acceptable level of power = 0.8/0.9 

```{r}

test_df <- data.frame("attitude2reply" = c(-0.0432, -0.0298, -0.0183),
                      "attitude2replier" = c(-0.0708, -0.0613, -0.00146),
                      "groups" = c("female_upvoate", "male", "male_upvote"))
 
tidy_pwr_ttest <- function(effect_size){
    pwr.t.test(n = 250, d = effect_size, sig.level = 0.05, power = NULL) %>%
        tidy() %>%
        select(power)
}

power_res <- reduce(
    list( 
    test_df %>% select(groups),
    map_df(test_df$attitude2reply, tidy_pwr_ttest) %>%
    rename("attitude2reply"  = "power"),
map_df(test_df$attitude2replier, tidy_pwr_ttest) %>%
    rename("attitude2replier" = "power")), 
    bind_cols)

power_res %>%
    pivot_longer(cols = contains("attitude"),
                 names_to = "dv",
                 values_to = "obs") %>%
    ggplot(aes(x = dv, y = obs, fill = groups)) +
        geom_col(position = "dodge") +
        geom_hline(yintercept = c(0.08), 
                   linetype = "dashed") +
        labs(x = "Outcome variables", 
             y = "Power", 
             fill = "Groups") +
        scale_x_discrete(labels = c("Attitude to Replier", "Attitude to Reply")) +
        theme_classic()

ggsave(here("outputs", "power_cal.png"))

```